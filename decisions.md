# JamVote 의사결정 내역

> 프로젝트 개발 과정에서 내린 주요 기술적, 기능적 결정과 그 근거를 기록합니다.

---

## 1. 데이터베이스: MongoDB 선택

**결정일**: 2025-10-14

### 결정 내용
관계형 DB(MySQL, PostgreSQL) 대신 MongoDB 사용

### 근거
#### 장점
- **빠른 개발**: 스키마 유연성, 초기 필드 추가/변경 용이
- **학습 곡선**: 관계형 DB 경험자도 쉽게 적응 (Mongoose ODM 사용)
- **바이브 코딩 친화적**: 표준화된 패턴, 풍부한 예제
- **무료 호스팅**: MongoDB Atlas 무료 티어 512MB (충분)
- **JSON 친화적**: 프론트엔드와 데이터 구조 일치

#### 고려사항
- 관계형 DB 대비 트랜잭션 지원 약함 → 이 프로젝트에서는 불필요
- JOIN 성능 → Mongoose `populate()`로 해결 가능

### 구현 예시
```javascript
// 간단한 Insert
await db.collection('jams').insertOne({
  jamId: 'abc123',
  name: '우리 밴드',
  expireAt: new Date('2025-05-01')
});

// Populate (JOIN)
await Song.find({ jamId }).populate('votes');
```

---

## 2. 보안 수준: 편의성 우선

**결정일**: 2025-10-14

### 결정 내용
최소한의 보안 조치만 적용, 편의성 우선

### 기본 보안 조치
- ✅ bcrypt 비밀번호 해시 (saltRounds: 10)
- ✅ 방 ID 랜덤 생성 (6자리 영문+숫자, 21억 가지 조합)
- ✅ HTTPS (Vercel/Railway 자동 제공)

### 생략한 보안 기능
- ❌ 2단계 인증
- ❌ 이메일 인증
- ❌ CSRF 토큰 (Phase 1)
- ❌ Rate limiting (Phase 2로 연기)

### 근거
1. **서비스 특성**
   - 일회성 사용 (30~90일 후 자동 삭제)
   - 중요 개인정보 없음 (이메일, 전화번호 불필요)
   - 밴드 멤버 간 사회적 통제 (악의적 행동 시 즉시 인지)

2. **피해 범위 제한**
   - 최악의 경우: 한 방의 투표 데이터만 영향
   - 실제 피해: 합주곡 선정 방해 정도

3. **벤치마크**
   - When2Meet, Doodle 등 유사 서비스도 비슷한 보안 수준

### 보안 vs 편의성 트레이드오프
| 기능 | 보안 위험 | 편의성 이득 | 결정 |
|------|----------|------------|------|
| 비밀번호 선택 사항 | 타인 접근 가능 | 진입장벽 낮춤 | ✅ 채택 |
| 비밀번호 없는 수정 | 악의적 수정 | UX 간소화 | ✅ 채택 |
| localStorage 세션 | XSS 위험 | 재로그인 불필요 | ✅ 채택 |

---

## 3. 이름 중복 체크: 공백 차단 + 대소문자 구분

**결정일**: 2025-10-14
**수정일**: 2025-10-16

### 결정 내용 (최종)
- 공백 입력 자체를 차단 (프론트엔드 + 백엔드 검증)
- 대소문자 구분 (John과 john은 다른 사람)
- `normalizedName` 필드 불필요 ❌

### 변경 이유
1. **사용자 혼란 제거**: 공백이 있는/없는 이름을 다르게 보면 헷갈림
2. **직관성**: "John"으로 가입했으면 "john"은 다른 사람
3. **단순성**: DB 필드 하나 줄어듦, 로직 간단

### 구현
```javascript
// 프론트엔드: 공백 입력 차단
<input
  onChange={(e) => setName(e.target.value.replace(/\s/g, ''))}
/>

// 백엔드: 공백 검증
if (/\s/.test(name)) {
  return res.status(400).json({
    error: "이름에 공백을 사용할 수 없습니다"
  });
}

// 중복 체크 (단순 일치)
const exists = await User.findOne({ jamId, name });
```

### 동작 예시
| 입력 1 | 입력 2 | 중복 여부 |
|--------|--------|----------|
| 김철수 | 김철수 | ❌ 중복 |
| John | john | ✅ 허용 (다른 사람) |
| "김 철수" | - | ❌ 입력 불가 (공백 자동 제거) |

### DB 스키마
```javascript
{
  name: String  // normalizedName 필드 삭제
}
```

---

## 4. 투표 로직: 상호배타적 단일 투표

**결정일**: 2025-10-14

### 결정 내용
한 곡에 "좋아요"와 "불가능" 중 하나만 선택 가능

### 규칙
- ✅ 여러 곡에 투표 가능
- ✅ 투표 변경 가능 (좋아요 → 불가능)
- ✅ 투표 취소 가능
- ❌ 한 곡에 좋아요+불가능 동시 불가

### DB 제약
```javascript
// Unique Index: (songId, userName)
await Vote.collection.createIndex(
  { songId: 1, userName: 1 },
  { unique: true }
);
```

### 근거
- 논리적 모순 방지 (좋아요하면서 불가능?)
- 투표 결과 명확성 (찬성/반대 명확)
- 변경 허용으로 유연성 확보

---

## 5. 실시간 동기화: Socket.io 사용

**결정일**: 2025-10-14

### 결정 내용
Socket.io 사용, 폴링(Polling) 방식 미채택

### Socket.io 선택 근거
| 항목 | Socket.io | 폴링 (3초 주기) |
|------|-----------|----------------|
| 구현 난이도 | ⭐⭐☆☆☆ 쉬움 | ⭐☆☆☆☆ 더 쉬움 |
| 실시간성 | 즉시 반영 | 최대 3초 지연 |
| 서버 부하 | 낮음 | 높음 (불필요한 요청) |
| 바이브 코딩 | 공식 문서 풍부 | 직접 구현 |
| 재연결 처리 | 자동 | 수동 구현 필요 |

### 구현 예시
```javascript
// 서버
io.to(jamId).emit('newVote', { songId, userName, type });

// 클라이언트
socket.on('newVote', (data) => {
  setVotes(prev => [...prev, data]);
});
```

### 난이도 평가
- 2년차 백엔드 개발자 기준 **30분 내 구현 가능**
- 공식 문서 예제로 충분히 학습 가능

### 네트워크 불안정 대응
- Socket.io 자동 재연결 활용
- localStorage 임시 저장으로 데이터 손실 방지

---

## 6. 크론 잡 실행 시간: 매일 새벽 1시

**결정일**: 2025-10-14

### 결정 내용
만료된 방 삭제 작업을 매일 새벽 1시에 실행

```javascript
cron.schedule('0 1 * * *', async () => {
  await Jam.deleteMany({ expireAt: { $lt: new Date() } });
});
```

### 근거
- **사용자 영향 최소화**: 새벽 시간대 트래픽 최저
- **서버 부하 분산**: 낮 시간 API 요청과 겹치지 않음
- **UTC 고려 불필요**: 한국 사용자 대상 서비스

### 대안 검토
- 실시간 삭제 (expireAt 지나면 즉시): 불필요한 체크 증가
- 주 1회 실행: 만료된 방이 너무 오래 남음

---

## 7. 방 유효기한: 7/15/30/60/90일 선택

**결정일**: 2025-10-14

### 결정 내용
기본값 30일, 드롭다운에서 5가지 옵션 제공

### 근거
1. **사용자 편의성**: 직접 입력보다 선택이 쉬움
2. **일반적 사용 패턴**:
   - 7일: 급하게 곡 정하는 경우
   - 15일: 평균적인 합주 준비 기간
   - 30일: 기본값 (충분한 기간)
   - 60일: 여유 있게 논의
   - 90일: 장기 프로젝트 (최대 3개월)

### 대안 검토
- **자유 입력 (1~90일)**: 사용자 실수 가능성 (999일 입력 등)
- **무제한 옵션**: DB 용량 문제

---

## 8. UI/UX: 모바일 최적화 가이드

**결정일**: 2025-10-14

### 결정 내용
모바일 우선 디자인, 터치 친화적 UI

### 주요 가이드라인
| 항목 | 기준 | 근거 |
|------|------|------|
| 최소 화면 크기 | 320px | iPhone SE 등 소형 기기 대응 |
| 터치 영역 | 44x44px | Apple HIG 권장 |
| 폰트 크기 | 16px 이상 | 한글 가독성 (모바일) |
| 모달 스타일 | Bottom Sheet | 손가락 닿기 쉬움 |
| 자동 포커스 | 최소화 | 키보드 자동 팝업 방지 |

### 근거
- **사용자 환경**: "사용자들은 모바일 환경에서 접근할 가능성이 높다" (요구사항)
- **사용 맥락**: 밴드 연습실, 카페 등에서 스마트폰으로 사용
- **벤치마크**: 카카오톡 투표, 디스코드 모바일 참고

---

## 9. 기술 스택 선택 요약

**결정일**: 2025-10-14

### 프론트엔드: React + Vite
- **React**: 가장 많은 자료, 바이브 코딩 친화적
- **Vite**: CRA보다 빠른 빌드, 가벼움
- **TypeScript**: 타입 안정성 (개발 속도 향상)
- **Tailwind CSS**: 빠른 스타일링, 반응형 쉬움

### 백엔드: Node.js + Express
- **Node.js**: 프론트엔드와 동일 언어 (학습 부담 감소)
- **Express**: 미니멀, 빠른 API 구축

### 호스팅: 무료 티어 활용
- **Vercel (프론트)**: 자동 배포, 무료 HTTPS
- **Railway/Render (백엔드)**: 무료 티어, Docker 불필요
- **MongoDB Atlas (DB)**: 512MB 무료 (충분)

### 근거
- **개발 속도**: 빠른 프로토타이핑, MVP 빠른 출시
- **비용**: 초기 무료로 운영 가능
- **확장성**: 트래픽 증가 시 유료 전환 쉬움

---

## 10. Phase 구분 전략

**결정일**: 2025-10-14

### Phase 1 (MVP - 2주 목표)
핵심 기능만 구현, 최소 사용 가능한 상태
- 방 생성/접속
- 프로필 생성/로그인
- 곡 검색/추가
- 곡 투표
- 실시간 동기화

### Phase 2 (추가 기능 - 1주)
사용자 경험 개선
- 댓글
- 프로필 수정
- 방 유효기한 수정
- 피드백 모달
- Rate limiting

### Phase 3 (확장 - 추후)
부가 기능, 실제 사용 피드백 반영 후
- AI 자동 판단
- 데이터 백업
- 대댓글

### 근거
- **빠른 검증**: MVP로 사용자 반응 확인
- **리소스 집중**: 핵심 기능에 집중
- **유연한 조정**: Phase 2/3는 피드백 반영하여 조정 가능

---

## 11. 세션 아이콘: SVG 세트 사용

**결정일**: 2025-10-14

### 결정 내용
UI 통일성을 위해 기존 이모지 아이콘 대신, 선으로 디자인된 SVG 아이콘 세트를 사용한다.

### 아이콘 세트
- **보컬 (Vocal)**
  ```xml
  <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 15C14.2091 15 16 13.2091 16 11V6C16 3.79086 14.2091 2 12 2C9.79086 2 8 3.79086 8 6V11C8 13.2091 9.79086 15 12 15Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M19 11V12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12V11" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M12 19V22" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  ```
- **기타 (Guitar)**
  ```xml
  <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M15.152 2.664l-3.464 6.0l-1.732 3.0l-3.464 6.001l-2.598 4.5m2.598-4.5l2.598-4.5m-2.598 4.5h-1.732m1.732-9.0l1.732-3.0m-3.464 6.0l1.732-3.0m0 0l-5.196-9.002l-1.732 3.001l5.196 9.001M8.66 4.33l-1.732 3.001m11.258 1.499l-1.732 3.0m-1.732-3.0l1.732-3.001m3.464 6.001l-1.732 3.0m-1.732-3.0l1.732-3.0m-1.732 3.0l1.732 3.0m-5.196 9.0l1.732-3.001m-1.732 3.001l-1.732-3.001m3.464 0l1.732-3.001" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M8.66 4.33L19.918 6.497L21.65 9.498L10.392 7.33L8.66 4.33z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  ```
- **베이스 (Bass)**
  ```xml
  <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M14 12.5L15.5 11M14 9.5L15.5 8M14 6.5L15.5 5M10.042 20.998L4.002 15C2.814 13.812 2.713 12.068 3.454 10.533C4.073 9.243 5.33 8.43 6.738 8.43H9.5M10.042 20.998C10.015 21.55 9.55 22 9 22C8.45 22 8 21.553 7.973 21.002L10.042 20.998ZM10.042 20.998L10.5 3.5C10.5 2.672 11.172 2 12 2C12.828 2 13.5 2.672 13.5 3.5V20.5C13.5 21.328 12.828 22 12 22C11.172 22 10.5 21.328 10.5 20.5L10.042 20.998Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  ```
- **드럼 (Drums)**
  ```xml
  <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M10 18L4 16M14 18L20 16M12 19V14M7 15.5C7 16.8807 9.23858 18 12 18C14.7614 18 17 16.8807 17 15.5M7 15.5V14.5C7 13.1193 9.23858 12 12 12C14.7614 12 17 13.1193 17 14.5V15.5M7 15.5C7 14.1193 9.23858 13 12 13C14.7614 13 17 14.1193 17 15.5M18 10L16 12M6 10L8 12" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  ```
- **키보드 (Keyboard)**
  ```xml
  <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M3 17V7C3 5.89543 3.89543 5 5 5H19C20.1046 5 21 5.89543 21 7V17C21 18.1046 20.1046 19 19 19H5C3.89543 19 3 18.1046 3 17Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M7 14V10H6V14H7ZM11 14V10H10V14H11ZM15 14V10H14V14H15ZM18 14V10H17V14H18Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  ```
- **기타/미지정 (Other/Unassigned)**
  ```xml
  <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M20 21V19C20 16.7909 18.2091 15 16 15H8C5.79086 15 4 16.7909 4 19V21" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  ```

### 근거
- **UI 일관성**: 모든 아이콘의 스타일을 통일하여 전문적이고 깔끔한 인상을 준다.
- **명확성**: 이모지보다 각 악기를 더 명확하게 표현한다.

---

## 12. 세션 이름 정책: MVP에서는 정규화 미적용

**결정일**: 2025-10-14

### 결정 내용
세션 종류 중 '기타(직접입력)'을 통해 사용자가 입력하는 세션 이름을 MVP 단계에서는 별도의 정규화(normalization) 없이 그대로 저장한다.

### 근거
- **MVP 범위 단순화**: MVP 단계에서는 세션별 통계나 필터링 기능이 핵심이 아니므로, 복잡한 정규화 규칙을 적용하기보다 빠른 구현에 집중한다.
- **사용자 자율성 존중**: '일렉기타', '어쿠스틱' 등 사용자가 원하는 구체적인 세션명을 그대로 표시하는 것이 사용자에게 더 많은 정보를 제공할 수 있다.
- **추후 확장 가능**: 서비스가 고도화되어 세션 기반 기능이 필요해지면, 그때 가서 데이터 마이그레이션 및 정규화 전략을 수립해도 늦지 않다.

---

## 13. MVP 기능 축소: 네트워크 불안정 시 임시 저장 기능 제외

**결정일**: 2025-10-14

### 결정 내용
'네트워크 불안정 시 입력값 임시 저장' 기능을 MVP(Phase 1) 범위에서 제외한다.

### 근거
- **구현 복잡도**: 사용자가 기능을 인지하고 자연스럽게 사용하게 만들기 위한 UI/UX까지 고려하면 MVP 단계에서 구현하기에는 다소 복잡하다고 판단.
- **개발 속도**: 핵심 기능에 집중하여 빠른 MVP 출시를 위해, 부가적인 사용자 경험 향상 기능은 Phase 2 이후로 연기하는 것이 효율적임.
- **요구사항 변경**: 최초 요구사항에 포함되어 있었으나, 논의 과정에서 복잡성을 인지하고 제외하기로 합의함.

---

## 변경 이력
- 2025-10-14: 초기 문서 작성, 대화 기반 요구사항 구체화 및 일부 기능 제외 결정
- 2025-10-16: 이름 중복 체크 로직 단순화 (normalizedName 필드 제거, 공백 차단, 대소문자 구분)